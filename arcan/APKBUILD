# Maintainer: user <user@local.host>
pkgname=arcan
pkgver=0.6.2
pkgrel=0
pkgdesc="desktop engine"
options="suid"
url="https://divergent-desktop.org"
arch="x86 x86_64 aarch64"
license="void"
subpackages="$pkgname-doc"
checkdepends="bash"
#srcdir="$startdir"
source="$pkgname-$pkgver.tgz"
builddir="$srcdir/$pkgname-$pkgver"
makedepends="
	cmake
	pkgconf
	coreutils
	wayland-dev
	wayland-protocols
	mesa-dev
	ffmpeg-dev
	file-dev
	freetype-dev
	xz-dev
	openal-soft-dev
	libusb-dev
	libvncserver-dev
	libxkbcommon-dev
	sqlite-dev
	vlc-dev
	sdl2-dev
	libxcb-dev
	xcb-util-dev
	xcb-util-wm-dev
	mupdf-dev
	harfbuzz-dev
	jbig2dec-dev
	gumbo-parser-dev
	openjpeg-dev
	espeak-dev
	tesseract-ocr-dev
	musl-fts-dev
	"
giturl="https://github.com/letoram/arcan"

snapshot() {
 git clone --depth 1 $giturl "/tmp/$pkgname-$pkgver"
 "/tmp/$pkgname-$pkgver/external/git/clone.sh"
 sed -i "/tmp/$pkgname-$pkgver/src/a12/CMakeLists.txt" -e '/set(LIBRARIES/ a\\tfts' # fts fix
 install -m 755 -d "/tmp/$pkgname-$pkgver/build"
 cd /tmp
 tar cfz "$startdir/$pkgname-$pkgver.tgz" "$pkgname-$pkgver"
 rm -rf "/tmp/$pkgname-$pkgver"
}

build() {
 export CFLAGS="-Wno-error"
 cmake -B "$builddir/build" -S "$builddir/src" -DBUILD_PRESET="everything" -DCMAKE_INSTALL_PREFIX="/usr"
 make -j$(nproc) -C "$builddir/build"
}

package() {
 make DESTDIR="$pkgdir" -j$(nproc) -C "$builddir/build" install
}

sha512sums="
ef317b90ceb3e5269a032f7ebf564d15678f7b95830ff89e499279dc0bc43f98ec399d2bd9aa215fcf380f33012cb32c9819df135ca731aaee38f223c08b37f5  arcan-0.6.2.tgz
"
